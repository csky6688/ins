<?xml version="1.0" encoding="UTF-8" ?>    
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cableCheck.dao.ReformOrderReportDao">

	<sql id="dynamicWhere_QUERYWLJB">
			<if test="queryParams.WLJB_ID != null and queryParams.WLJB_ID != ''">  
	            <![CDATA[
		    	AND oed.net_layer_id IN (${queryParams.WLJB_ID})
		    	]]>
		  </if>
	</sql>	
	<sql id="dynamicWhere_DOWNWLJB">
			<if test="WLJB_ID != null and WLJB_ID != ''">  
	            <![CDATA[
		    	AND oed.net_layer_id IN (${WLJB_ID})
		    	]]>
		  </if>
	</sql>	

<select id="query" parameterType="map" resultType="map">
select t.*,
       a1.name cityname,
       a1.area_level,
        decode((周期性检查总数 + 一键反馈总数 + 不可预告抽查总数),
              0,
              0,
              round(((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发) /
                    (周期性检查总数 + 一键反馈总数 + 不可预告抽查总数)),
                    4) * 100) || '%' 整治派发率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查已整治 + 一键反馈已整治 + 不可预告抽查已整治) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治回单率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查通过审核 + 一键反馈通过审核 + 不可预告抽查通过审核) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治完成率按设备,
       decode(上报整改端子数,
              0,
              0,
              round((派发整改端子数 /
                                                           上报整改端子数),
                    4) * 100) || '%' 整治派发率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改回单端子数 /
                                                        派发整改端子数),
                    4) * 100) || '%' 整治回单率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改成功端子数 /
                                                      派发整改端子数),
                    4) * 100) || '%' 整治完成率按端子,
       decode((整改成功端子数+检查人员一键改端子数),
              0,
              0,
              round(((整改成功端子数+检查人员一键改端子数) /
                                                      发现错误端子数),
                    4) * 100) || '%' "2018年整改率"
  from (select a.name,
  			   a.area_id AREAID,
               a.parent_area_id,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                   and oed.phy_eqp_id = task.SBID
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                    and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 周期性检查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 	 and oed.phy_eqp_id = task.SBID
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <=  to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   
                  
                   ) 周期性检查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 	 and oed.phy_eqp_id = task.SBID
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                  	<include refid="dynamicWhere_QUERYWLJB" />
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  
                   
                   ) 周期性检查已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 	 and oed.phy_eqp_id = task.SBID
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
           <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>  
		  <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  ) 周期性检查未通过审核,    
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 	 and oed.phy_eqp_id = task.SBID
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  
		  
		     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  ) 周期性检查通过审核,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 一键反馈总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈已整治,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈通过审核,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 不可预告抽查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查已整治,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查通过审核,
				 (select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                    <include refid="dynamicWhere_QUERYWLJB" />
                    and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   union  all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                      <include refid="dynamicWhere_QUERYWLJB" />
                      and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd') ) m  where m.son_area_id = a.area_id) 发现错误端子数,
                   
                      ( select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                    <include refid="dynamicWhere_QUERYWLJB" />
                    and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                     <include refid="dynamicWhere_QUERYWLJB" />
                      and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd') ) m   where m.son_area_id = a.area_id)  检查人员一键改端子数,
               
                (select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                    	<include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd') ) m  where m.son_area_id = a.area_id) 上报整改端子数,
                   
                  ( select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in (1,2)
                   and task.is_need_zg = 1 
                   and task.status_id in (5,6,7,8)
                   and r.record_type in (1,3)
                   and r.port_id is not null 
                   and r.ischeckok = 1
                   	<include refid="dynamicWhere_QUERYWLJB" /> 
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                    and task.status_id in (5,6,7,8)
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id)派发整改端子数,
                   
                   
                (select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.status_id in (7,8)
                   and task.is_need_zg = 1 
                   and r.record_type =2
                   and r.port_id is not null 
                   and r.ischeckok = 0 
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                    and task.status_id in (7,8)
                     and  r.record_type =2
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id) 整改回单端子数,
                   
                     (select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and task.status_id = 8
                   and task.is_need_zg = 1 
                   and r.record_type =2
                   and r.port_id is not null 
                   and r.ischeckok = 0 
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                     and  r.record_type =2
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   and task.status_id = 8
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time) <= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id) 整改成功端子数
                   
          from area a where 1=1 
          <if test="queryParams.son_area != null and queryParams.son_area != ''">  
	            <![CDATA[
		    	AND a.area_id = #{queryParams.son_area}
		    	]]>
		  </if>) t
  left join area a1
    on a1.area_id = t.parent_area_id
 where a1.area_level = 3
<if test="queryParams.AREA_ID != null and queryParams.AREA_ID != ''">  
	            <![CDATA[
		    and a1.area_id   = #{queryParams.AREA_ID}
		    	]]>
		  </if>

</select>


<select id="queryDown" parameterType="map" resultType="map">
select t.*,
       a1.name cityname,
       a1.area_level,
       decode((周期性检查总数 + 一键反馈总数 + 不可预告抽查总数),
              0,
              0,
              round(((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发) /
                    (周期性检查总数 + 一键反馈总数 + 不可预告抽查总数)),
                    4) * 100) || '%' 整治派发率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查已整治 + 一键反馈已整治 + 不可预告抽查已整治) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治回单率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查通过审核 + 一键反馈通过审核 + 不可预告抽查通过审核) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治完成率按设备,
       decode(上报整改端子数,
              0,
              0,
              round((派发整改端子数 /
                                                           上报整改端子数),
                    4) * 100) || '%' 整治派发率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改回单端子数 /
                                                        派发整改端子数),
                    4) * 100) || '%' 整治回单率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改成功端子数 /
                                                      派发整改端子数),
                    4) * 100) || '%' 整治完成率按端子,
       decode((整改成功端子数+检查人员一键改端子数),
              0,
              0,
              round(((整改成功端子数+检查人员一键改端子数) /
                                                      发现错误端子数),
                    4) * 100) || '%' "2018年整改率"            
  from (select a.name,
               a.parent_area_id,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed  
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 周期性检查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  
                  
                    <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   ) 周期性检查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  
		  
                  
                   ) 周期性检查已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                  and task.status_id in(6,7)
                  and task.audit_status=1
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  
                 
                   ) 周期性检查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		  
		  
                 
                   ) 周期性检查通过审核,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 一键反馈总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈通过审核,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 不可预告抽查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查已整治,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		                    <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.son_area_id = a.area_id
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		                    <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查通过审核,
		  
		  (select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   union  all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                      <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd') ) m
                 where m.son_area_id = a.area_id) 发现错误端子数,
                 
                    ( select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                       <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd') ) m   where m.son_area_id = a.area_id)  检查人员一键改端子数,
		  
		  
                (select count(m.port_id) from ( 
                   select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) m  where m.son_area_id = a.area_id) 上报整改端子数,
                   
                  ( select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1 
                   and task.status_id in (5,6,7,8)
                   and r.record_type in (1,3)
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                    and task.status_id in (5,6,7,8)
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id)派发整改端子数,
                   
                   
                (select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1 
                   and task.status_id in (7,8)
                   and r.record_type =2
                   and r.port_id is not null 
                   and r.ischeckok = 0 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                    and task.status_id in (7,8)
                     and  r.record_type =2
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id) 整改回单端子数,
                   
                   
                   (select count(m.port_id) from (
                  select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1 
                   and task.status_id = 8
                   and r.record_type =2
                   and r.port_id is not null 
                   and r.ischeckok = 0 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   union all select r.port_id,task.son_area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type = 3 
                     and  r.record_type =2
                      and r.port_id is not null 
                      and task.status_id = 8
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>)m where m.son_area_id = a.area_id) 整改成功端子数
                   
                   
          from area a where 1=1 
          <if test="son_area != null and son_area != ''">  
	            <![CDATA[
		    	AND a.area_id = #{son_area}
		    	]]>
		  </if>) t
  left join area a1
    on a1.area_id = t.parent_area_id
 where a1.area_level = 3
<if test="AREA_ID != null and AREA_ID != ''">  
	            <![CDATA[
		    and a1.area_id   = #{AREA_ID}
		    	]]>
		  </if>

</select>

<select id="queryByCity" parameterType="map" resultType="map">
select t.*,
      decode((周期性检查总数 + 一键反馈总数 + 不可预告抽查总数),
              0,
              0,
              round(((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发) /
                    (周期性检查总数 + 一键反馈总数 + 不可预告抽查总数)),
                    4) * 100) || '%' 整治派发率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查已整治 + 一键反馈已整治 + 不可预告抽查已整治) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治回单率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查通过审核 + 一键反馈通过审核 + 不可预告抽查通过审核) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治完成率按设备,
       decode(上报整改端子数,
              0,
              0,
              round((派发整改端子数 /
                                                           上报整改端子数),
                    4) * 100) || '%' 整治派发率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改回单端子数 /
                                                        派发整改端子数),
                    4) * 100) || '%' 整治回单率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改成功端子数 /
                                                      派发整改端子数),
                    4) * 100) || '%' 整治完成率按端子,
       decode((整改成功端子数+检查人员一键改端子数),
              0,
              0,
              round(((整改成功端子数+检查人员一键改端子数) /
                                                      发现错误端子数),
                    4) * 100) || '%' "2018年整改率"
  from (select a.name,
               a.area_id AREAID,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 周期性检查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.status_id = 8
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 一键反馈总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                     <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;=  to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈已整治,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time  &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;=  to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                     <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time  &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;=  to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                     <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time  &gt;=  to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) 不可预告抽查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查已整治,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                 and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.area_id = a.area_id
                   	<include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查通过审核,
		  (select count(m.port_id) from ( 
                   select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                    	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;=to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   union  all select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                     	<include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;=to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd') ) m  where m.area_id = a.area_id) 发现错误端子数,
		  
		    ( select count(m.port_id) from ( 
                   select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                   <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;=to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                    <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;=to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd') ) m  where m.area_id = a.area_id)  检查人员一键改端子数,
		  
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                            left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and r.record_type in (1,3)
                           and r.port_id is not null
                           and r.ischeckok = 1
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and r.record_type = 0
                           and r.port_id is not null
                           and r.ischeckok = 1
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')) m
                 where m.area_id = a.area_id) 上报整改端子数,
               
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and task.status_id in (5,6,7,8)
                           and r.record_type in (1,3)
                           and r.port_id is not null
                           and r.ischeckok = 1
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                             <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and task.status_id in (5,6,7,8)
                           and r.record_type = 0
                           and r.port_id is not null
                           and r.ischeckok = 1
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                          and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                          <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 派发整改端子数,
               
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                         and task.status_id in (7,8)
                           and task.is_need_zg = 1
                           and r.record_type = 2
                           and r.port_id is not null
                           and r.ischeckok = 0
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                             <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and r.record_type = 2
                           and task.status_id in (7,8)
                           and r.port_id is not null
                           and r.ischeckok = 0
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                             <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                 <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 整改回单端子数,
                 
                 (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and task.status_id = 8
                           and r.record_type = 2
                           and r.port_id is not null
                           and r.ischeckok = 0
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                             <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and r.record_type = 2
                           and task.status_id = 8
                           and r.port_id is not null
                           and r.ischeckok = 0
                           	<include refid="dynamicWhere_QUERYWLJB" />
                           and task.start_time &gt;=
                               to_date(#{queryParams.START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{queryParams.COMPLETE_TIME}, 'yyyy-mm-dd')
                            <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
	            <![CDATA[
		   and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                 <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
	            <![CDATA[
		  and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                     <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
	            <![CDATA[
		  and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
	            <![CDATA[
		  and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 整改成功端子数
          from area a
         where 1 = 1
         <if test="queryParams.AREA_ID != null and queryParams.AREA_ID != ''">  
	            <![CDATA[
		    and a.area_id   = #{queryParams.AREA_ID}
		    	]]>
		  </if>
           and a.area_level = 3) t
</select>

<select id="queryDownByCity" parameterType="map" resultType="map">
select t.*,
      decode((周期性检查总数 + 一键反馈总数 + 不可预告抽查总数),
              0,
              0,
              round(((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发) /
                    (周期性检查总数 + 一键反馈总数 + 不可预告抽查总数)),
                    4) * 100) || '%' 整治派发率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查已整治 + 一键反馈已整治 + 不可预告抽查已整治) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治回单率按设备 ,
       decode((周期性检查派发 + 一键反馈派发 + 不可预告抽查派发),
              0,
              0,
              round(((周期性检查通过审核 + 一键反馈通过审核 + 不可预告抽查通过审核) /
                    (周期性检查派发 + 一键反馈派发 + 不可预告抽查派发)),
                    4) * 100) || '%' 整治完成率按设备,
       decode(上报整改端子数,
              0,
              0,
              round((派发整改端子数 /
                                                           上报整改端子数),
                    4) * 100) || '%' 整治派发率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改回单端子数 /
                                                        派发整改端子数),
                    4) * 100) || '%' 整治回单率按端子 ,
       decode(派发整改端子数,
              0,
              0,
              round((整改成功端子数 /
                                                      派发整改端子数),
                    4) * 100) || '%' 整治完成率按端子,
       decode((整改成功端子数+检查人员一键改端子数),
              0,
              0,
              round(((整改成功端子数+检查人员一键改端子数) /
                                                      发现错误端子数),
                    4) * 100) || '%' "2018年整改率"
  from (select a.name,
               a.area_id,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;=  to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 周期性检查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                 and oed.phy_eqp_id = task.SBID
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                 and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查已整治,
		  	(select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查未通过审核,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 3
                  and oed.phy_eqp_id = task.SBID
                   and task.status_id = 8
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 周期性检查通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 一键反馈总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                  and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                     and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                 and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                     and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 1
                     and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                    <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 一键反馈通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                    and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) 不可预告抽查总数,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                    and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (5, 6, 7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查派发,
               
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in (7, 8)
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查已整治,
                (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id in(6,7)
                   and task.audit_status=1
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查未通过审核,
               (select count(1)
                  from tb_cablecheck_task task,odso_eqp_daily oed
                 where task.task_type = 2
                   and oed.phy_eqp_id = task.SBID
                   and task.is_need_zg = 1
                   and task.status_id = 8
                   and task.area_id = a.area_id
                    <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{START_TIME}, 'yyyy-mm-dd')
                   and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) 不可预告抽查通过审核,
		  
		  (select count(m.port_id) from ( 
                   select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                    <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   union  all select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                      <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd') ) m
                 where m.area_id = a.area_id) 发现错误端子数,
                 
                    ( select count(m.port_id) from ( 
                   select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                    <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                   union all  select r.port_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                      <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd') 
                      ) m   where m.area_id = a.area_id)  检查人员一键改端子数,
		  
		  
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and r.record_type in (1,3)
                           and r.port_id is not null
                           and r.ischeckok = 1
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and r.record_type = 0
                           and r.port_id is not null
                           and r.ischeckok = 1
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')) m
                 where m.area_id = a.area_id) 上报整改端子数,
               
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and task.status_id in (5,6,7,8)
                           and r.record_type in (1,3)
                           and r.port_id is not null
                           and r.ischeckok = 1
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                           <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                         left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and task.status_id in (5,6,7,8)
                           and r.record_type = 0
                           and r.port_id is not null
                           and r.ischeckok = 1
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                           <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 派发整改端子数,
               
               (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                         and task.status_id in (7,8)
                           and task.is_need_zg = 1
                           and r.record_type = 2
                           and r.port_id is not null
                           and r.ischeckok = 0
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                            <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                         left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                         and task.status_id in (7,8)
                           and r.record_type = 2
                           and r.port_id is not null
                           and r.ischeckok = 0
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                          and trunc(task.start_time)  &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                           <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
		                    <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 整改回单端子数,
                 
                  (select count(m.port_id)
                  from (select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                          left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type in (1, 2)
                           and task.is_need_zg = 1
                           and r.record_type = 2
                           and r.port_id is not null
                           and r.ischeckok = 0
                           and task.status_id = 8
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                           and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                           <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                 <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                        union all
                        select r.port_id, task.area_id
                          from tb_cablecheck_task task
                          left join tb_cablecheck_record r
                            on task.task_id = r.task_id
                         left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                         where task.task_type = 3
                           and r.record_type = 2
                           and task.status_id = 8
                           and r.port_id is not null
                           and r.ischeckok = 0
                            <include refid="dynamicWhere_DOWNWLJB" />
                           and task.start_time &gt;=
                               to_date(#{START_TIME}, 'yyyy-mm-dd')
                          and trunc(task.start_time) &lt;= to_date(#{COMPLETE_TIME}, 'yyyy-mm-dd')
                          <if test="PSTART_TIME != null and PSTART_TIME != ''">  
	            <![CDATA[
		    and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
	            <![CDATA[
		    and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MSTART_TIME != null and MSTART_TIME != ''">  
	            <![CDATA[
		    and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
	            <![CDATA[
		   and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                    <if test="ASTART_TIME != null and ASTART_TIME != ''">  
	            <![CDATA[
		     and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>
                   <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
	            <![CDATA[
		 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
		    	]]>
		  </if>) m
                 where m.area_id = a.area_id) 整改成功端子数
          from area a
         where 1 = 1
         <if test="AREA_ID != null and AREA_ID != ''">  
	            <![CDATA[
		    and a.area_id   = #{AREA_ID}
		    	]]>
		  </if>
           and a.area_level = 3) t
</select>

	<!-- 周期性检查上报 -->
    <select id="zgEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3  
			      <include refid="dynamicWhere_QUERYWLJB" />              
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				
    </select>
    <!-- 周期性检查上报派发 -->
    <select id="zgPfEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in (5, 6, 7, 8)
			      <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期性检查上报回单 -->
    <select id="zgHdEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in (7, 8)
			      <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				 		 and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期性检查上报审核 -->
    <select id="zgShEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id = 8
			      <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 一键反馈检查上报 -->
    <select id="yjEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 一键反馈检查上报派发 -->
    <select id="yjPfEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in (5, 6, 7, 8)
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 一键反馈检查上报回单 -->
    <select id="yjHdEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
			     AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in (7, 8)
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				 		 and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 一键反馈检查上报审核 -->
    <select id="yjShEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                   and task.status_id = 8
                   <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 不预告检查上报 -->
    <select id="bygEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报派发 -->
    <select id="bygPfEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in (5, 6, 7, 8)
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报回单 -->
    <select id="bygHdEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in (7, 8)
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				 		 and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报审核 -->
    <select id="bygShEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                   and task.status_id = 8
                   <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
     
     <!-- 导出 -->  
     <!-- 周期性检查上报 -->
    <select id="exportZgEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期性检查上报派发 -->
    <select id="exportZgPfEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in (5, 6, 7, 8)
			      <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期性检查上报回单 -->
    <select id="exportZgHdEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in (7, 8)
			      <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		         <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期性检查上报审核 -->
    <select id="exportZgShEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id = 8
			      <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 一键反馈检查上报 -->
     <select id="exportYjEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
					AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>  
        <!-- 一键反馈检查上报派发 -->
    <select id="exportYjPfEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in (5, 6, 7, 8)
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 一键反馈检查上报回单 -->
    <select id="exportYjHdEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in (7, 8)
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		         <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 一键反馈检查上报审核 -->
    <select id="exportYjShEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                   and task.status_id = 8
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 不预告检查上报 -->
    <select id="exportBygEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报派发 -->
    <select id="exportBygPfEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
					AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in (5, 6, 7, 8)
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报回单 -->
    <select id="exportBygHdEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
					AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in (7, 8)
                  <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		         <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 不预告检查上报审核 -->
    <select id="exportBygShEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                   and task.status_id = 8
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select> 
    
    <select id="isArea" parameterType="string" resultType="map">
		 select a.area_level from area a where a.area_id=#{areaId}
    </select> 
     <!-- 发现错误端子数  -->
    <select id="zgFxEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
       m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
                    else '已整改' end ischeckok from ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_QUERYWLJB" />
                    and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   union  all select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                  <include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                    ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1 
                  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
     <!-- 一键改端子数  -->
    <select id="zgYjgEquipmentPortQuery" parameterType="map" resultType="map">
		 select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
       m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
                    else '已整改' end ischeckok from ( 
                   select  r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                  <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')  
                   union all  select  r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                    <include refid="dynamicWhere_QUERYWLJB" />
                      and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd') 
                    )  m left join area a on a.area_id=m.son_area_id   
                  where 1=1 
					<if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
       <!-- 上报整改端子数 -->
    <select id="zgEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')     
                   union all   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   	<include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  
                   ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
      <!-- 派发整改端子数  -->
    <select id="zgPfEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
         						m.STAFF_NAME_ZG
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,
                   r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,ff.staff_name STAFF_NAME_ZG from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     left join tb_base_staff ff on ff.staff_id=task.maintor
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type in (1,3) 
                   and task.status_id in (5,6,7,8)              
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union all  select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,
                   r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,ff.staff_name STAFF_NAME_ZG from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                      left join tb_base_staff ff on ff.staff_id=task.maintor
                     where task.task_type = 3 
                     and  r.record_type =0
                      and task.status_id in (5,6,7,8)
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   <include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd') 
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 整改回单端子数   -->
    <select id="zgHdEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name STAFF_NAME_ZG,to_char(m.create_time, 'yyyy/mm/dd') CREATE_TIME_ZG,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
         ff.staff_name,to_char(re1.create_time,'yyyy/mm/dd')create_time
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type =2
                  and task.status_id in (7,8)            
                   and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				 		 and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union all  select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =2
                     and task.status_id in (7,8)
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				 		 and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   ) m 
                  left join area a on a.area_id=m.son_area_id   
                  left join tb_cablecheck_record re1 on re1.task_id=m.task_id and re1.ischeckok=1 and re1.port_id=m.port_id
        		  left join tb_base_staff ff on ff.staff_id=re1.create_staff
                  where 1=1
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
        <!-- 整改成功端子数   -->
    <select id="zgCgEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name STAFF_NAME_ZG,to_char(m.create_time, 'yyyy/mm/dd') CREATE_TIME_ZG,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
          ff.staff_name,to_char(re1.create_time,'yyyy/mm/dd')create_time
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,
                   r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type =2
                  and task.status_id =8            
                   and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_QUERYWLJB" />
                   and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union all  select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =2
                     and task.status_id =8
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_QUERYWLJB" />
                     and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd') 
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		           <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  
                  ) m 
                  left join area a on a.area_id=m.son_area_id  
                  left join tb_cablecheck_record re1 on re1.task_id=m.task_id and re1.ischeckok=1 and re1.port_id=m.port_id
        		  left join tb_base_staff ff on ff.staff_id=re1.create_staff 
                  where 1=1
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 端子导出 -->
     <!-- 发现错误端子数 -->
    <select id="exportZgFxEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
      			 m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
                    else '已整改' end ischeckok from ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_DOWNWLJB" />
                    and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   union  all select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                     left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                    <include refid="dynamicWhere_DOWNWLJB" />
                      and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                     ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1 
	                  <if test="area_level != null and area_level != '' and area_level ==4">  
			            <![CDATA[
				    		and m.son_area_id = #{areaId}
				    	]]>
					  </if>
					  <if test="area_level != null and area_level != '' and area_level ==3">  
			            <![CDATA[
				    		and m.area_id = #{areaId}
				    	]]>
					  </if>
    </select>
    <!-- 一键改端子数 -->
    <select id="exportZgYjgEquipmentPortQuery" parameterType="map" resultType="map">
		 select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time, 'yyyy/mm/dd')create_time,
       			m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
                    else '已整改' end ischeckok from ( 
                   select  r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type in(1,2)
                    and  r.record_type in (1,3)               
                    and r.port_id is not null 
                    and r.changeportid is not null
                 	<include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   union all  select  r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                   left join odso_eqp_daily oed on oed.phy_eqp_id = task.SBID
                    where task.task_type =0 
                      and  r.record_type =0
                      and r.port_id is not null 
                      and r.changeportid is not null
                   	<include refid="dynamicWhere_DOWNWLJB" />
                      and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                    )  m left join area a on a.area_id=m.son_area_id   
                  where 1=1 
                  <if test="area_level != null and area_level != '' and area_level ==4">  
			            <![CDATA[
				    		and m.son_area_id = #{areaId}
				    	]]>
					  </if>
					  <if test="area_level != null and area_level != '' and area_level ==3">  
			            <![CDATA[
				    		and m.area_id = #{areaId}
				    	]]>
					  </if>
    </select>
       <!-- 上报整改端子数 -->
    <select id="exportZgEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time)create_time,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                    and  r.record_type in (1,3)               
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   union all  select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =0
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   <include refid="dynamicWhere_DOWNWLJB" />
                     and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd') ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
      <!-- 派发整改端子数  -->
    <select id="exportZgPfEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name,to_char(m.create_time)create_time,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
         						m.STAFF_NAME_ZG
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,r.descript,r.record_type,r.ischeckok,
                   task.son_area_id,task.area_id,ff.staff_name STAFF_NAME_ZG from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                      left join tb_base_staff ff on ff.staff_id=task.maintor
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type in (1,3) 
                   and task.status_id in (5,6,7,8)              
                   and r.port_id is not null 
                   and r.ischeckok = 1 
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union  all select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,r.info,
                   r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id ,ff.staff_name STAFF_NAME_ZG from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                      left join tb_base_staff ff on ff.staff_id=task.maintor
                     where task.task_type = 3 
                     and  r.record_type =0
                      and task.status_id in (5,6,7,8)
                      and r.port_id is not null 
                   and r.ischeckok = 1
                   <include refid="dynamicWhere_DOWNWLJB" />
                     and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   ) m left join area a on a.area_id=m.son_area_id   
                  where 1=1
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 整改回单端子数   -->
    <select id="exportZgHdEquipmentPortQuery" parameterType="map" resultType="map">
		select distinct a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name STAFF_NAME_ZG,to_char(m.create_time) CREATE_TIME_ZG,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
         	ff.staff_name,to_char(re1.create_time,'yyyy/mm/dd')create_time
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type =2
                  and task.status_id in (7,8)            
                   and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,
                   r.remark,r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =2
                     and task.status_id in (7,8)
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                     and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   ) m 
                  left join area a on a.area_id=m.son_area_id   
                  left join tb_cablecheck_record re1 on re1.task_id=m.task_id and re1.ischeckok=1 and re1.port_id=m.port_id
        		  left join tb_base_staff ff on ff.staff_id=re1.create_staff 
                  where 1=1
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
        <!-- 整改成功端子数   -->
    <select id="exportZgCgEquipmentPortQuery" parameterType="map" resultType="map">
		select  a.name,m.eqp_id,m.eqp_no,m.eqp_name,m.port_id,m.port_no,m.staff_name STAFF_NAME_ZG,to_char(m.create_time) CREATE_TIME_ZG,
		   m.remark,m.info,m.descript, case m.ischeckok when '1' then '未整改'
         						else '已整改' end ischeckok,
        ff.staff_name,to_char(re1.create_time,'yyyy/mm/dd')create_time
  			 from    ( 
                   select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                   left join tb_base_staff f on f.staff_id=r.create_staff
                    left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                    where task.task_type in(1,2)
                   and task.is_need_zg = 1
                   and  r.record_type =2
                  and task.status_id =8            
                   and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                   and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                   and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   union all  select r.port_id,r.eqp_id,r.eqp_no,r.eqp_name,r.port_no,f.staff_name,r.create_time,r.remark,
                   r.info,r.descript,r.record_type,r.ischeckok,task.son_area_id,task.area_id,task.task_id from tb_cablecheck_task task 
                   left join tb_cablecheck_record r on task.task_id =r.task_id
                    left join tb_base_staff f on f.staff_id=r.create_staff
                     left join  odso_eqp_daily oed  on OED.phy_eqp_id = TASK.SBID
                     where task.task_type = 3 
                     and  r.record_type =2
                     and task.status_id =8
                      and r.port_id is not null 
                   and r.ischeckok = 0
                   <include refid="dynamicWhere_DOWNWLJB" />
                     and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time)&lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   ) m 
                  left join area a on a.area_id=m.son_area_id   
                  left join tb_cablecheck_record re1 on re1.task_id=m.task_id and re1.ischeckok=1 and re1.port_id=m.port_id
        		  left join tb_base_staff ff on ff.staff_id=re1.create_staff 
                  where 1=1
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and m.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and m.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
    <!-- 周期新检查审核不通过 -->
    <select id="zgShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in(6,7)
			      and task.audit_status=1
			      <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                   <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
    <!-- 一键反馈上报审核不通过 -->
  <select id="yjShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in(6,7)
                  and task.audit_status=1
                   <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                    <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
     <!-- 不预告上报审核不通过 -->
    <select id="bygShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select task.task_id,a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in(6,7)
                  and task.audit_status=1
                   <include refid="dynamicWhere_QUERYWLJB" />
                  and task.start_time &gt;= to_date(#{queryParams.task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{queryParams.task_end_time}, 'yyyy-mm-dd')
                  <if test="queryParams.PSTART_TIME != null and queryParams.PSTART_TIME != ''">  
			            <![CDATA[
				   		and task.paifa_time >= to_date(#{queryParams.PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.PCOMPLETE_TIME != null and queryParams.PCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.paifa_time)<= to_date(#{queryParams.PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MSTART_TIME != null and queryParams.MSTART_TIME != ''">  
			            <![CDATA[
				  		and task.modify_time >= to_date(#{queryParams.MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.MCOMPLETE_TIME != null and queryParams.MCOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.modify_time)<= to_date(#{queryParams.MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ASTART_TIME != null and queryParams.ASTART_TIME != ''">  
			            <![CDATA[
				  		and task.audit_complete_time >= to_date(#{queryParams.ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="queryParams.ACOMPLETE_TIME != null and queryParams.ACOMPLETE_TIME != ''">  
			            <![CDATA[
				  		and trunc(task.audit_complete_time)<= to_date(#{queryParams.ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{queryParams.areaId}
			    	]]>
				  </if>
				  <if test="queryParams.area_level != null and queryParams.area_level != '' and queryParams.area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{queryParams.areaId}
			    	]]>
				  </if>
    </select>
     <!-- 周期性检查上报审核不通过 -->
    <select id="exportZgShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 3
			      and task.status_id in(6,7)
			      and task.audit_status=1
			      <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                  <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
     <!-- 一键反馈检查上报审核不通过 -->
    <select id="exportYjShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 1
                  and task.is_need_zg = 1
                  and task.status_id in(6,7)
                  and task.audit_status=1
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>    
     <!-- 不预告检查上报审核不通过 -->
    <select id="exportBygShAgainstEquipmentQuery" parameterType="map" resultType="map">
		select a.name,tb.equipment_name,tb.equipment_code,tb.address,tb.res_type,tb.manage_area 
		from tb_cablecheck_task task,tb_cablecheck_equipment tb,area a, odso_eqp_daily oed
			where task.sbid=tb.equipment_id
				AND oed.phy_eqp_id = task.SBID
			      and task.son_area_id=a.area_id
			      and task.task_type = 2
                  and task.is_need_zg = 1
                  and task.status_id in(6,7)
                  and task.audit_status=1
                   <include refid="dynamicWhere_DOWNWLJB" />
                  and task.start_time &gt;= to_date(#{task_start_time}, 'yyyy-mm-dd')
                  and trunc(task.start_time) &lt;= to_date(#{task_end_time}, 'yyyy-mm-dd')
                   <if test="PSTART_TIME != null and PSTART_TIME != ''">  
			            <![CDATA[
				    	and task.paifa_time >= to_date(#{PSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="PCOMPLETE_TIME != null and PCOMPLETE_TIME != ''">  
			            <![CDATA[
				    	and trunc(task.paifa_time)<= to_date(#{PCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MSTART_TIME != null and MSTART_TIME != ''">  
			            <![CDATA[
				    	and task.modify_time >= to_date(#{MSTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="MCOMPLETE_TIME != null and MCOMPLETE_TIME != ''">  
			            <![CDATA[
				   		and trunc(task.modify_time)<= to_date(#{MCOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
				  
				  <if test="ASTART_TIME != null and ASTART_TIME != ''">  
			            <![CDATA[
				     	and task.audit_complete_time >= to_date(#{ASTART_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
		          <if test="ACOMPLETE_TIME != null and ACOMPLETE_TIME != ''">  
			            <![CDATA[
						 and trunc(task.audit_complete_time)<= to_date(#{ACOMPLETE_TIME}, 'yyyy-mm-dd')
				    	]]>
				  </if>
                   <if test="area_level != null and area_level != '' and area_level ==4">  
		            <![CDATA[
			    		and task.son_area_id = #{areaId}
			    	]]>
				  </if>
				  <if test="area_level != null and area_level != '' and area_level ==3">  
		            <![CDATA[
			    		and task.area_id = #{areaId}
			    	]]>
				  </if>
    </select>
</mapper>